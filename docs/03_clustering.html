<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Clustering – Data Science Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Data Science Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01_introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-dataprepeda" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">DataPrep/EDA</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-dataprepeda">    
        <li>
    <a class="dropdown-item" href="./02_01_overview.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02_02_data_gathering_and_cleaning.html">
 <span class="dropdown-text">Data Gathering and Data Cleaning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02_03_data_visualization.html">
 <span class="dropdown-text">Data Visualization</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modelmethod" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Model/Method</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modelmethod">    
        <li>
    <a class="dropdown-item" href="./03_clustering.html">
 <span class="dropdown-text">Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04_pca.html">
 <span class="dropdown-text">Principal Component Analysis (PCA)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05_naive_bayes.html">
 <span class="dropdown-text">Naïve Bayes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06_decision_trees.html">
 <span class="dropdown-text">Decision Trees</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11_boosting.html">
 <span class="dropdown-text">Boosting</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./12_results.html"> 
<span class="menu-text">Results</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./13_project_challenges.html"> 
<span class="menu-text">Project Challenges</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./10_conclusions.html"> 
<span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/taso5789/ds-project-portfolio"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/taihei-sone-586102253/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#data-prep" id="toc-data-prep" class="nav-link" data-scroll-target="#data-prep">Data Prep</a></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code">Code</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#silhouette-scores-of-k-means-and-hierarchical-clustering" id="toc-silhouette-scores-of-k-means-and-hierarchical-clustering" class="nav-link" data-scroll-target="#silhouette-scores-of-k-means-and-hierarchical-clustering">Silhouette Scores of K-Means and Hierarchical Clustering</a></li>
  <li><a href="#hierarchical-clustering-dendrogram" id="toc-hierarchical-clustering-dendrogram" class="nav-link" data-scroll-target="#hierarchical-clustering-dendrogram">Hierarchical Clustering Dendrogram</a></li>
  <li><a href="#related-to-q1-out-of-10-research-questions-in-introduction" id="toc-related-to-q1-out-of-10-research-questions-in-introduction" class="nav-link" data-scroll-target="#related-to-q1-out-of-10-research-questions-in-introduction">Related to Q1 (out of 10 Research Questions) in Introduction</a></li>
  <li><a href="#related-to-q2-out-of-10-research-questions-in-introduction" id="toc-related-to-q2-out-of-10-research-questions-in-introduction" class="nav-link" data-scroll-target="#related-to-q2-out-of-10-research-questions-in-introduction">Related to Q2 (out of 10 Research Questions) in Introduction</a>
  <ul class="collapse">
  <li><a href="#u.s.-recession" id="toc-u.s.-recession" class="nav-link" data-scroll-target="#u.s.-recession">U.S. Recession</a></li>
  <li><a href="#zero-lower-bound-period" id="toc-zero-lower-bound-period" class="nav-link" data-scroll-target="#zero-lower-bound-period">Zero Lower Bound Period</a></li>
  <li><a href="#covid-19-era" id="toc-covid-19-era" class="nav-link" data-scroll-target="#covid-19-era">COVID-19 Era</a></li>
  </ul></li>
  <li><a href="#related-to-q4-out-of-10-research-questions-in-introduction" id="toc-related-to-q4-out-of-10-research-questions-in-introduction" class="nav-link" data-scroll-target="#related-to-q4-out-of-10-research-questions-in-introduction">Related to Q4 (out of 10 Research Questions) in Introduction</a>
  <ul class="collapse">
  <li><a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering">K-Means Clustering</a></li>
  <li><a href="#hierarchical-clustering" id="toc-hierarchical-clustering" class="nav-link" data-scroll-target="#hierarchical-clustering">Hierarchical Clustering</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Clustering</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="justify">
<p>Notes: All images displayed on this page are free-use materials, unless otherwise indicated by a specific credit.</p>
</div>
<section id="overview" class="level1">
<h1>Overview</h1>
<div class="justify">
<ul>
<li><p><strong>Clustering</strong> is an unsupervised learning technique that groups similar data points together based on their characteristics. The purpose of clustering is discovery—it allows us to identify hidden structures, patterns, or natural groupings within the data without relying on predefined labels. There are two major approaches to clustering: <strong>partitional clustering</strong> and <strong>hierarchical clustering</strong>.</p>
<ul>
<li><p><strong>Partitional clustering</strong> (e.g., k-means) divides the dataset into a fixed number of clusters. Each data point is assigned to exactly one cluster, and the algorithm iteratively updates cluster centers to minimize within-cluster distances. This approach is computationally efficient and works well when the number of clusters is known in advance.</p></li>
<li><p><strong>Hierarchical clustering</strong> builds a tree-like structure (dendrogram) to represent nested groupings of the data. It can be performed in two ways: agglomerative (bottom-up, starting with individual points and merging them into clusters) or divisive (top-down, starting with one large cluster and splitting it into smaller clusters). Unlike k-means, it does not require specifying the number of clusters beforehand, and the dendrogram provides insight into multiple levels of grouping.</p></li>
</ul></li>
<li><p>A key element in clustering is the <strong>distance metric</strong>, which defines how similarity between data points is measured. Common metrics include Euclidean distance (straight-line distance in space), Manhattan distance (sum of absolute differences across dimensions), and Cosine similarity (measuring the angle between vectors, useful for text or high-dimensional data). The choice of distance metric can significantly affect the resulting clusters and must be carefully aligned with the nature of the data.</p></li>
<li><p>In this project, clustering will be used to explore hidden groupings in the dataset and provide insights that may not be immediately visible through simple descriptive statistics. Specifically, K-Means and hierarchical clustering will be applied to standardized macroeconomic indicators to uncover distinct regimes. The quality and number of clusters will be evaluated using silhouette scores and dendrogram analysis. To validate the discovered groupings, the distribution of regime dummies (<code>USREC</code>, <code>ZLB_dummy</code>, <code>COVID_dummy</code>) within each cluster will be examined via cross-tabs and donut/pie charts to assess alignment with historical episodes such as recessions, the zero lower bound period, and the COVID-19 era. In addition, cluster-wise and regime-wise scatter plots of unemployment and inflation will be used to evaluate how strongly the short-run Phillips curve relationship is preserved across regimes.</p></li>
</ul>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fig_03_overview_01.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fig_03_overview_02.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-prep" class="level1">
<h1>Data Prep</h1>
<div class="justify">
<ul>
<li><strong>Clustering methods require only unlabeled numeric data</strong>. Unlike supervised learning, where models are trained with predefined labels or categories, clustering is an unsupervised approach that seeks to discover hidden groupings in the data without prior knowledge of class membership. Because of this, categorical labels or outcome variables are not necessary and, in fact, must be excluded during the clustering process to avoid biasing the results. In addition, the input data must be numeric since clustering algorithms, such as k-means and hierarchical clustering, rely on distance or similarity measures (e.g., Euclidean distance, cosine similarity). These measures are mathematically defined only for numerical variables. If the dataset includes categorical or textual features, they need to be transformed into numeric representations (for example, one-hot encoding for categorical variables or vectorization methods for text) before clustering can be applied.</li>
</ul>
</div>
<div class="justify">
<ul>
<li>The sample image of the data used in the analysis on this page is shown below. This dataset corresponds to the one shown in “Merged Cleaned Data” at the end of <a href="./02_02_data_gathering_and_cleaning.html">Data Gathering and Data Cleaning</a>.</li>
</ul>
</div>
<div class="text-center">
<p><img src="results/2_Clustering/data.jpg" class="img-fluid" style="width:100.0%"></p>
</div>
<div class="justify">
<ul>
<li>The above dataset can be found <a href="https://github.com/taso5789/ds-project-portfolio/tree/main/data/df_merged.csv">here</a>.</li>
</ul>
</div>
</section>
<section id="code" class="level1">
<h1>Code</h1>
<div class="justify">
<ul>
<li>For the code used in this chapter (Clustering), please refer <a href="https://github.com/taso5789/ds-project-portfolio/blob/main/code/2_Clustering.ipynb">here</a>.</li>
</ul>
</div>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="silhouette-scores-of-k-means-and-hierarchical-clustering" class="level2">
<h2 class="anchored" data-anchor-id="silhouette-scores-of-k-means-and-hierarchical-clustering">Silhouette Scores of K-Means and Hierarchical Clustering</h2>
<div class="justify">
<ul>
<li><p>The silhouette analysis of K-Means clustering (Euclidean distance) shows that the silhouette scores remain relatively modest across all values of <em>k</em>, peaking at about <strong>0.27 when k = 12</strong>. This suggests that while K-Means does identify some meaningful separation at this cluster size, the overall cohesion within clusters and separation between clusters is limited. In other words, the structure captured by K-Means is relatively weak, and the method may be less effective at uncovering clear macroeconomic regimes in this dataset.</p></li>
<li><p>In contrast, hierarchical clustering with cosine distance yields consistently higher silhouette scores, reaching about <strong>0.42 for k = 11</strong>. <strong>This indicates that hierarchical clustering provides more coherent and well-separated clusters, making it more reliable for identifying distinct macroeconomic states</strong>.</p></li>
<li><p>Despite these differences, <strong>both methods converge on a similar conclusion: around 11–12 clusters represent a reasonable range</strong> for capturing the underlying structure of the data. This agreement suggests that the existence of multiple macroeconomic regimes is robust to the choice of clustering method.</p></li>
<li><p>Taken together, both methods point to <strong>11–12 clusters as a reasonable range</strong>, but hierarchical clustering is clearly the stronger approach in this application.</p></li>
<li><p>In the figures below, the left side shows the results of K-Means Clustering, while the right side shows the results of Hierarchical Clustering.</p></li>
</ul>
</div>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="justify">
<div id="K-Means-Silhouette-Scores" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/kmeans_silhouette_scores.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Silhouette scores of K-Means clustering (Euclidean distance) across different numbers of clusters (<em>k</em> = 2–19). The scores peak at <em>k</em> = 12 (≈0.28), suggesting that around 12 clusters provide the most coherent separation under this method.</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="justify">
<div id="Hierarchical-Silhouette-Scores" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/hierarchical_silhouette_scores.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Silhouette scores of hierarchical clustering with cosine distance across different numbers of clusters (<em>k</em> = 2–19). The scores reach their highest values at <em>k</em> = 11 (≈0.42), indicating stronger cohesion and separation compared to K-Means.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="hierarchical-clustering-dendrogram" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-clustering-dendrogram">Hierarchical Clustering Dendrogram</h2>
<div class="justify">
<ul>
<li>The figure below is a hierarchical clustering dendrogram based on cosine distance and average linkage. The vertical axis indicates the distance at which clusters merge, with lower values representing greater similarity. Cutting the tree around a distance of 0.6 yields approximately 11–12 distinct clusters, corresponding to different macroeconomic regimes such as normal periods, recessions, and shock episodes.</li>
</ul>
</div>
<div class="justify">
<div id="Hierarchical-Clustering-Dendrogram" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/hierarchical_clustering_dendrogram.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Hierarchical clustering dendrogram using cosine distance and average linkage. The vertical axis indicates the distance at which clusters merge, with lower values representing greater similarity. Cutting the dendrogram around a distance of 0.6 suggests approximately 11–12 distinct clusters, corresponding to different macroeconomic regimes.</figcaption>
</figure>
</div>
</div>
</section>
<section id="related-to-q1-out-of-10-research-questions-in-introduction" class="level2">
<h2 class="anchored" data-anchor-id="related-to-q1-out-of-10-research-questions-in-introduction">Related to Q1 (out of 10 Research Questions) in <a href="./01_introduction.html">Introduction</a></h2>
<div class="justify">
<p><strong>Is a short-run trade-off between inflation and unemployment statistically observable?</strong></p>
<ul>
<li><p>Yes, it is. In both figures (2D scatterplots of unemployment rate <code>UNRATE</code> and inflation rate <code>PCEPILFE YoY</code>), periods of higher inflation coincide with lower unemployment clusters (upper-left), while periods of higher unemployment coincide with lower or even negative inflation clusters (lower-right).</p></li>
<li><p>Although the relationship is not a perfect straight line, the presence of distinct clusters indicates that the short-run Phillips curve trade-off is statistically observable.</p></li>
<li><p>In the figures below, the left side shows the results of K-Means Clustering, while the right side shows the results of Hierarchical Clustering.</p></li>
</ul>
</div>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="justify">
<div id="K-Means-Clustering" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/kmeans_clusters_k12.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>K-Means clustering results with <em>k</em> = 12 on standardized features. The scatter plot shows unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis), with points colored by cluster assignment. Distinct groupings illustrate the short-run Phillips curve trade-off, where clusters with higher inflation correspond to lower unemployment and vice versa.</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="justify">
<div id="Hierarchical-Clustering" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/hierarchical_clusters_k11.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Hierarchical clustering results with <em>k</em> = 11 on standardized features. The scatter plot shows unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis), with points colored by cluster assignment. The clusters reveal distinct groupings that highlight the short-run Phillips curve trade-off, where periods of higher inflation are generally associated with lower unemployment, and vice versa.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="related-to-q2-out-of-10-research-questions-in-introduction" class="level2">
<h2 class="anchored" data-anchor-id="related-to-q2-out-of-10-research-questions-in-introduction">Related to Q2 (out of 10 Research Questions) in <a href="./01_introduction.html">Introduction</a></h2>
<div class="justify">
<p><strong>To what extent does the Phillips curve relationship vary across business-cycle phases (recessions and expansions) and policy regimes (e.g., the zero lower bound period or the COVID-19 era)?</strong></p>
<ul>
<li><p>By conducting clustering based on whether the economy was in a recession or not (<code>USREC</code> = 0/1), during the Zero Lower Bound (ZLB) period or not (<code>ZLB_dummy</code> = 0/1), and in the COVID-19 era or not (<code>COVID_dummy</code> = 0/1), the negative relationship between unemployment and inflation was generally preserved in all cases. In other words, although the slope varied in strength across different economic phases and policy regimes, the basic Phillips curve relationship consistently held.</p></li>
<li><p>In the figures below, the left sides show the results of K-Means Clustering, while the right sides show the results of Hierarchical Clustering.</p></li>
</ul>
</div>
<section id="u.s.-recession" class="level3">
<h3 class="anchored" data-anchor-id="u.s.-recession">U.S. Recession</h3>
<section id="non-recession-period-usrec-0" class="level4">
<h4 class="anchored" data-anchor-id="non-recession-period-usrec-0">Non-Recession Period (<code>USREC</code> = 0)</h4>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="justify">
<div id="KMeans-Clustering-USREC-0" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_USREC/USREC_0/kmeans_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>K-Means clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during non-recession periods (<code>USREC</code> = 0). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 9. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved outside recessions.</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="justify">
<div id="Hierarchical-Clustering-USREC-0" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_USREC/USREC_0/hclust_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Hierarchical clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during non-recession periods (<code>USREC</code> = 0). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 10. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved outside recessions.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="recession-period-usrec-1" class="level4">
<h4 class="anchored" data-anchor-id="recession-period-usrec-1">Recession Period (<code>USREC</code> = 1)</h4>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="justify">
<div id="KMeans-Clustering-USREC-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_USREC/USREC_1/kmeans_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>K-Means clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during recession periods (<code>USREC</code> = 1). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 3. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved within recessions.</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="justify">
<div id="Hierarchical-Clustering-USREC-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_USREC/USREC_1/hclust_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Hierarchical clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during recession periods (<code>USREC</code> = 1). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 2. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved within recessions.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="zero-lower-bound-period" class="level3">
<h3 class="anchored" data-anchor-id="zero-lower-bound-period">Zero Lower Bound Period</h3>
<section id="non-zero-lower-bound-period-zlb_dummy-0" class="level4">
<h4 class="anchored" data-anchor-id="non-zero-lower-bound-period-zlb_dummy-0">Non-Zero Lower Bound Period (<code>ZLB_dummy</code> = 0)</h4>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="justify">
<div id="KMeans-Clustering-ZLB-0" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_ZLB_dummy/ZLB_dummy_0/kmeans_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>K-Means clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during non-zero lower bound periods (<code>ZLB_dummy</code> = 0). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 7. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved outside zero lower bound periods.</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="justify">
<div id="Hierarchical-Clustering-ZLB-0" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_ZLB_dummy/ZLB_dummy_0/hclust_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Hierarchical clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during non-zero lower bound periods (<code>ZLB_dummy</code> = 0). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 3. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved outside zero lower bound periods.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="zero-lower-bound-period-zlb_dummy-1" class="level4">
<h4 class="anchored" data-anchor-id="zero-lower-bound-period-zlb_dummy-1">Zero Lower Bound Period (<code>ZLB_dummy</code> = 1)</h4>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="justify">
<div id="KMeans-Clustering-ZLB-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_ZLB_dummy/ZLB_dummy_1/kmeans_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>K-Means clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during zero lower bound periods (<code>ZLB_dummy</code> = 1). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 5. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved during zero lower bound periods.</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="justify">
<div id="Hierarchical-Clustering-ZLB-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_ZLB_dummy/ZLB_dummy_1/hclust_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Hierarchical clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during zero lower bound periods (<code>ZLB_dummy</code> = 1). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 13. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved during zero lower bound periods.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="covid-19-era" class="level3">
<h3 class="anchored" data-anchor-id="covid-19-era">COVID-19 Era</h3>
<section id="non-covid-19-era-covid_dummy-0" class="level4">
<h4 class="anchored" data-anchor-id="non-covid-19-era-covid_dummy-0">Non-COVID-19 Era (<code>COVID_dummy</code> = 0)</h4>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="justify">
<div id="KMeans-Clustering-COVID-0" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_COVID_dummy/COVID_dummy_0/kmeans_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>K-Means clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during non-COVID-19 era (<code>COVID_dummy</code> = 0). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 10. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved outside COVID-19 era.</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="justify">
<div id="Hierarchical-Clustering-COVID-0" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_COVID_dummy/COVID_dummy_0/hclust_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Hierarchical clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during non-COVID-19 era (<code>COVID_dummy</code> = 0). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 4. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved outside COVID-19 era.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="covid-19-bound-era-covid_dummy-1" class="level4">
<h4 class="anchored" data-anchor-id="covid-19-bound-era-covid_dummy-1">COVID-19 Bound Era (<code>COVID_dummy</code> = 1)</h4>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="justify">
<div id="KMeans-Clustering-COVID-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_COVID_dummy/COVID_dummy_1/kmeans_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>K-Means clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during COVID-19 era (<code>COVID_dummy</code> = 1). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 2. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved during COVID-19 era.</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="justify">
<div id="Hierarchical-Clustering-COVID-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/by_regime_COVID_dummy/COVID_dummy_1/hclust_scatter.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Hierarchical clustering results on standardized unemployment (<code>UNRATE</code>, x-axis) and inflation (<code>PCEPILFE_YoY</code>, y-axis) during COVID-19 era (<code>COVID_dummy</code> = 1). Based on silhouette analysis conducted for this subset, the optimal number of clusters was determined to be <em>k</em> = 6. The resulting clusters reveal distinct macroeconomic groupings, indicating that the short-run Phillips curve relationship is generally preserved during COVID-19 era.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="related-to-q4-out-of-10-research-questions-in-introduction" class="level2">
<h2 class="anchored" data-anchor-id="related-to-q4-out-of-10-research-questions-in-introduction">Related to Q4 (out of 10 Research Questions) in <a href="./01_introduction.html">Introduction</a></h2>
<div class="justify">
<p><strong>Does regime identification based on data-driven clustering align with historical episodes such as stagflation or the post–global financial crisis recovery?</strong></p>
<ul>
<li>Yes, it does. In both K-Means clustering and hierarchical clustering, each cluster tends to be strongly skewed toward either 0 or 1 for the dummy variables representing recessions (<code>USREC</code>), the zero lower bound period (<code>ZLB_dummy</code>), and the COVID era (<code>COVID_dummy</code>), suggesting the effectiveness of clustering in identifying regimes.</li>
</ul>
</div>
<section id="k-means-clustering" class="level3">
<h3 class="anchored" data-anchor-id="k-means-clustering">K-Means Clustering</h3>
<div class="justify">
<ul>
<li>In K-Means clustering, each cluster tends to be strongly skewed toward either 0 or 1 for the dummy variables representing recessions (USREC), the zero lower bound period (ZLB_dummy), and the COVID era (COVID_dummy), suggesting the effectiveness of clustering in identifying regimes. For example, focusing on Cluster 0, since <code>USREC</code> is entirely 0, <code>ZLB_dummy</code> is entirely 1, and <code>COVID_dummy</code> is entirely 0, it can be seen that the data classified into this cluster correspond to periods that are not recessions, are within the zero lower bound period, and are not during the COVID era, thereby allowing regimes to be clearly identified. For other clusters as well, although in some cases the proportions of 0 and 1 for certain dummy variables are nearly balanced, making regime identification more difficult, in general the regimes can be clearly distinguished.</li>
</ul>
</div>
<div class="justify">
<div id="K-Means-Label-Binary-Pies" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/pies_kmeans_label_binary_pies.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Distribution of dummy variables within clusters from K-Means clustering (<em>k</em> = 12). Each donut chart shows the share of 0 vs.&nbsp;1 for <code>USREC</code> (recessions), <code>ZLB_dummy</code> (zero lower bound period), and <code>COVID_dummy</code> (COVID-19 era) across clusters. Most clusters are strongly skewed toward either 0 or 1, indicating that K-Means effectively distinguishes macroeconomic regimes such as normal periods, recessions, the ZLB period, and the COVID-19 shock.</figcaption>
</figure>
</div>
</div>
</section>
<section id="hierarchical-clustering" class="level3">
<h3 class="anchored" data-anchor-id="hierarchical-clustering">Hierarchical Clustering</h3>
<div class="justify">
<ul>
<li>In hierarchical clustering, each cluster tends to be strongly skewed toward either 0 or 1 for the dummy variables representing recessions (USREC), the zero lower bound period (ZLB_dummy), and the COVID era (COVID_dummy), suggesting the effectiveness of clustering in identifying regimes. For example, focusing on Cluster 1, since <code>USREC</code>, <code>ZLB_dummy</code>, and <code>COVID_dummy</code> are all 0, it can be seen that the data classified into this cluster correspond to periods that are not recessions, are not within the zero lower bound period, and are not during the COVID era, thereby allowing regimes to be clearly identified. For other clusters as well, although in some cases the proportions of 0 and 1 for certain dummy variables are nearly balanced, making regime identification more difficult, in general the regimes can be clearly distinguished.</li>
</ul>
</div>
<div class="justify">
<div id="Hierarchical-Label-Binary-Pies" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="results/2_Clustering/pies_hclust_label_binary_pies.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Distribution of dummy variables within clusters from hierarchical clustering (<em>k</em> = 11). Each donut chart shows the share of 0 vs.&nbsp;1 for <code>USREC</code> (recessions), <code>ZLB_dummy</code> (zero lower bound period), and <code>COVID_dummy</code> (COVID-19 era) across clusters. Many clusters are strongly skewed toward either 0 or 1, indicating that hierarchical clustering effectively separates macroeconomic regimes such as normal periods, recessions, ZLB episodes, and the COVID-19 shock.</figcaption>
</figure>
</div>
</div>
</section>
</section>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<div class="justify">
<ul>
<li><p>This study applied both K-Means and hierarchical clustering to macroeconomic data in order to explore hidden structures related to the Phillips curve and regime shifts. The analysis shows that clustering methods can uncover meaningful groupings of economic conditions even without predefined labels.</p></li>
<li><p>Silhouette analysis suggests that hierarchical clustering with cosine distance provides more coherent and well-separated clusters than K-Means, with an optimal range of about 11–12 clusters. The dendrogram further highlights natural divisions that correspond to different macroeconomic states.</p></li>
<li><p>Across business-cycle phases and policy regimes (recessions, the zero lower bound period, and the COVID-19 era), the negative relationship between unemployment and inflation—the Phillips curve—was generally preserved, though the slope varied in strength across regimes. This indicates that the short-run trade-off remains statistically observable in different contexts.</p></li>
<li><p>Regime identification based on clustering aligns with historical episodes. Many clusters are strongly skewed toward one state of the dummy variables (USREC, ZLB_dummy, COVID_dummy), demonstrating that clustering can effectively distinguish between regimes such as normal periods, recessions, ZLB episodes, and the COVID-19 shock.</p></li>
<li><p>Taken together, these results suggest that unsupervised clustering techniques, particularly hierarchical clustering, are valuable tools for identifying macroeconomic regimes and for assessing the stability of the Phillips curve relationship under different economic conditions.</p></li>
</ul>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/taso5789\.github\.io\/ds-project-portfolio\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>